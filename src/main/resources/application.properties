# Database Configuration
quarkus.datasource.db-kind=mariadb
quarkus.datasource.username=${DB_USERNAME:gocommerceuser}
quarkus.datasource.password=${DB_PASSWORD:gocommercepass}
quarkus.datasource.jdbc.url=jdbc:mariadb://${DB_HOST:localhost}:${DB_PORT:3306}/${DB_NAME:gocommerce}
quarkus.datasource.jdbc.max-size=16

# Hibernate ORM - changed from 'update' to 'none' to prevent auto-schema changes
# Use Flyway for all schema migrations instead
quarkus.hibernate-orm.database.generation=${HIBERNATE_GENERATION:none}
quarkus.hibernate-orm.log.sql=true
quarkus.hibernate-orm.sql-load-script=no-file

# UUID configuration - to ensure Hibernate correctly recognizes UUID columns
quarkus.hibernate-orm.implicit-naming-strategy=component-path
quarkus.hibernate-orm.physical-naming-strategy=org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy
quarkus.hibernate-orm.jdbc.timezone=UTC

# Multi-tenant specific configuration
quarkus.hibernate-orm.multitenant=SCHEMA
quarkus.hibernate-orm.database.default-schema=public

# Flyway Migration Configuration - UPDATED to remove ambiguity in migration paths
quarkus.flyway.migrate-at-start=true
quarkus.flyway.baseline-on-migrate=true
quarkus.flyway.baseline-version=0.0.0
quarkus.flyway.schemas=${DB_NAME:gocommerce}
quarkus.flyway.table=flyway_schema_history
# Use only the master migrations for the main schema
quarkus.flyway.locations=db/migration/master
quarkus.flyway.validate-on-migrate=false
quarkus.flyway.repair-at-start=true

# Separate tenant migrations configuration - UNCHANGED
# The SchemaManager will handle tenant-specific migrations
quarkus.flyway.tenants.locations=db/migration/tenants

# OpenAPI Configuration
quarkus.smallrye-openapi.path=/openapi
quarkus.swagger-ui.path=/swagger-ui
quarkus.swagger-ui.always-include=true
quarkus.swagger-ui.title=GO Commerce API
quarkus.swagger-ui.theme=original

# OIDC with KeyCloak (placeholder config - to be updated with actual values)
quarkus.oidc.auth-server-url=http://localhost:${KEYCLOAK_PORT:9000}/realms/${KEYCLOAK_REALM:gocommerce}
quarkus.oidc.client-id=${KEYCLOAK_CLIENT_ID:gocommerce-client}
quarkus.oidc.credentials.secret=${KEYCLOAK_CLIENT_SECRET:secret}
quarkus.oidc.application-type=service

# Internationalization Configuration
quarkus.default-locale=en
quarkus.locales=en,pt_BR,pt,es
quarkus.http.same-site-cookie.locale-cookie.value=strict

# Setting for request path tenant resolver
# Comment this out if using the subdomain resolver only
# quarkus.http.root-path=/{tenantId}

# Development-only configuration
%dev.quarkus.hibernate-orm.database.generation=none
%dev.quarkus.hibernate-orm.sql-load-script=no-file
%dev.quarkus.flyway.migrate-at-start=true
%dev.quarkus.flyway.clean-at-start=false

# Test configuration - allow automatic schema creation in tests
%test.quarkus.hibernate-orm.database.generation=drop-and-create
%test.quarkus.hibernate-orm.sql-load-script=no-file
%test.quarkus.flyway.migrate-at-start=false